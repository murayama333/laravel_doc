# Introduction

Laravelの開発プロジェクトを開始するとき、エラーや例外ハンドリングの設定は既に完了しています。またLaravelはMonologロギングライブラリを統合しています。Monologは多機能なログハンドラです。


# Configuration

### Error Detail

アプリケーションのエラーの詳細をブラウザに表示するには```config/app.php```の```debug```オプションを設定します。デフォルトではこの設定は```.env```ファイルに定義された環境変数```APP_DEBUG```によって決定します。

ローカルでの開発環境ではAPP_DEBUGにはtrueを指定しておくと良いでしょう。一方でプロダクション環境の場合はfalseにすべきです。

### Log Modes

Laravelは```single```、```daily```、```syslog```、```errorlog```といったロギングモードをサポートしています。たとえば```single```ファイルではなく```daily```ログファイルを使いたい場合は```config/app.php```の```log```オプションを設定します。

```php
'log' => 'daily'
```

### Custom Monolog Configuration

アプリケーションにおいて、Monologを完全に制御したい場合はアプリケーションの```configureMonologUsing```メソッドを使います。このメソッドは```bootstrap/app.php```ファイルで```$app```変数を返却する前に呼び出します。

```php
$app->configureMonologUsing(function($monolog) {
    $monolog->pushHandler(...);
});

return $app;
```


# The Exception Handler

すべての例外は```App\Exceptions\Handler```クラスでハンドリングされます。このクラスには```report```と```render```という2つのメソッドを含みます。ここでは2つのメソッドの詳細を見てみることにしましょう。


# The Report Method

reportメソッドは例外ログを記録したり、BugSnagのような外部のWebサービスに例外ログを送信するために使用します。デフォルトのreportメソッドは親クラスに例外を渡すようになっています。親クラスでは例外をログに出力します。ここでは例外やログを適切に処理すると良いでしょう。

たとえば例外の種類によってレポートを切り替える場合、instanceof演算子を使って次のように実装できます。

```php
/**
 * Report or log an exception.
 *
 * This is a great spot to send exceptions to Sentry, Bugsnag, etc.
 *
 * @param  \Exception  $e
 * @return void
 */
public function report(Exception $e)
{
    if ($e instanceof CustomException) {
        //
    }

    return parent::report($e);
}
```

### Ignoring Exceptions By Type

例外ハンドラの```$dontReport```プロパティにはログ出力しない例外クラスを配列で指定できます。デフォルトでは404エラーの例外情報はログファイルに記録されないようになっています。この配列に任意の例外クラスを指定することができます。


# The Render Method

```render```メソッドは例外情報をブラウザに返却するHTTPレスポンスに変換します。デフォルトでは例外は親クラスのメソッドに処理され、HTTPレスポンスを生成するようになっています。次のように例外の型を調べてレスポンスをカスタマイズすることもできます。

```php
/**
 * Render an exception into an HTTP response.
 *
 * @param  \Illuminate\Http\Request  $request
 * @param  \Exception  $e
 * @return \Illuminate\Http\Response
 */
public function render($request, Exception $e)
{
    if ($e instanceof CustomException) {
        return response()->view('errors.custom', [], 500);
    }

    return parent::render($request, $e);
}
```

# HTTP Exceptions

いくつかの例外はサーバーからのHTTPステータスコードを表現します。たとえば"page not found"を示す404や、 "unauthorized error" を示す401、開発者の生成した500などです。アプリケーションの任意の場所でこれらの例外を生成するには次のように実装します。

```php
abort(404);
```

abortメソッドは例外をその場で発生させることで、例外ハンドラによってレンダリングされるようになっています。abortメソッドにはレスポンステキストを指定することもできます。

```
abort(403, 'Unauthorized action.');
```

このメソッドはリクエストのライフサイクルの中であればどこでも利用できます。


## Custom HTTP Error Pages

Laravel makes it easy to return custom error pages for various HTTP status codes. For example, if you wish to customize the error page for 404 HTTP status codes, create a resources/views/errors/404.blade.php. This file will be served on all 404 errors generated by your application.

The views within this directory should be named to match the HTTP status code they correspond to.


# Logging

The Laravel logging facilities provide a simple layer on top of the powerful Monolog library. By default, Laravel is configured to create daily log files for your application which are stored in the storage/logs directory. You may write information to the logs using the Log facade:

```php
<?php

namespace App\Http\Controllers;

use Log;
use App\User;
use App\Http\Controllers\Controller;

class UserController extends Controller
{
    /**
     * Show the profile for the given user.
     *
     * @param  int  $id
     * @return Response
     */
    public function showProfile($id)
    {
        Log::info('Showing user profile for user: '.$id);

        return view('user.profile', ['user' => User::findOrFail($id)]);
    }
}
```

The logger provides the eight logging levels defined in RFC 5424: emergency, alert, critical, error, warning, notice, info and debug.

```php
Log::emergency($error);
Log::alert($error);
Log::critical($error);
Log::error($error);
Log::warning($error);
Log::notice($error);
Log::info($error);
Log::debug($error);
```

### Contextual Information

An array of contextual data may also be passed to the log methods. This contextual data will be formatted and displayed with the log message:

Log::info('User failed to login.', ['id' => $user->id]);


### Accessing The Underlying Monolog Instance

Monolog has a variety of additional handlers you may use for logging. If needed, you may access the underlying Monolog instance being used by Laravel:

$monolog = Log::getMonolog();
